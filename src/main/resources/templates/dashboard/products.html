<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/dashboard-layout :: layout(~{::section})">

<head>
    <title>Products</title>
</head>
<body>
<section>
    <h1>Products</h1>
    <button type="button" onclick="openModal()" style="margin-bottom:1rem;">Create Product</button>

    <div class="products-container" style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <div th:each="product : ${products}" class="product-card"
             style="border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); padding: 1rem; border-radius: 8px; width: 220px; background: white;">

            <img th:if="${product.image != null}" th:src="${product.image}"
                 style="width: 100%; height: 150px; object-fit: cover; border-radius: 6px; margin-bottom: 0.5rem;" />

            <h3 th:text="${product.name}" style="font-size: 1.1rem; margin: 0 0 0.5rem;"></h3>
            <p>Price: $<span th:text="${product.price}"></span></p>
            <p>Category: <span th:text="${product.category.name}"></span></p>

            <div style="margin-top:10px;">
                <!-- View Modal -->
                <button type="button" class="btn btn-info btn-sm" onclick="openViewModal([[${product.id}]])">üëÅÔ∏è</button>

                <!-- Edit -->
                <a th:href="@{'/dashboard/products/edit/' + ${product.id}}" class="btn btn-warning btn-sm">‚úèÔ∏è</a>

                <!-- Delete -->
                <form th:action="@{'/dashboard/products/delete/' + ${product.id}}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">üóëÔ∏è</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Modal -->
    <div id="productModal" class="modal"
         style="display:none; position: fixed; z-index: 1050; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.5);">
        <div class="modal-content"
             style="background: white; padding: 20px; margin: 5% auto; width: 400px; border-radius: 10px; position: relative;">
            <span class="close-btn" onclick="closeModal()"
                  style="position: absolute; right: 15px; top: 10px; font-size: 1.5rem; cursor: pointer;">&times;</span>
            <h2>Create Product</h2>
            <form th:action="@{/dashboard/products/create}" method="post" th:object="${product}" enctype="multipart/form-data">
                <input type="file" name="imageFile"/> <br/>
                <label>Name:</label><br/>
                <input type="text" th:field="*{name}" required/><br/><br/>
                <label>Price:</label><br/>
                <input type="number" th:field="*{price}" step="0.01" required/><br/><br/>
                <label>Category:</label><br/>
                <select th:field="*{category.id}" required>
                    <option value="" disabled selected>Select category</option>
                    <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
                </select><br/><br/>
                <button type="submit">Save Product</button>
            </form>
        </div>
    </div>

    <script>
        function openModal() {
           document.getElementById("productModal").style.display = "block";
       }

       function closeModal() {
           document.getElementById("productModal").style.display = "none";
       }

       // Show details using alert
       function viewProduct(name, price, category) {
           alert(
               "Product Details:\n\n" +
               "Name: " + name + "\n" +
               "Price: $" + price + "\n" +
               "Category: " + category
           );
       }

       window.onclick = function(event) {
           const modal = document.getElementById("productModal");
           if (event.target === modal) { closeModal(); }
       }
    </script>
</section>
</body>
</html>

