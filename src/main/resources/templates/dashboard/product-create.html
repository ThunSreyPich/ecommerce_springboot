<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/dashboard-layout :: layout(~{::section})">
<head>
    <title>Create Product</title>
</head>
<body>
<section class="container py-4">
    <div class="mb-4">
        <h2>Create Product</h2>
    </div>

    <form th:action="@{/dashboard/products/create}" method="post"
          th:object="${product}" enctype="multipart/form-data" class="needs-validation" novalidate>

        <!-- Image Preview -->
        <div class="mb-3" style="max-width: 300px;">
            <img id="imagePreview" class="img-fluid rounded shadow-sm d-none" style="width: 100%; height: auto;" />
        </div>

        <!-- Upload Image -->
        <div class="mb-3">
            <label for="imageFile" class="form-label">Upload Image</label>
            <input id="imageFile" type="file" name="imageFile" class="form-control" onchange="previewImage(this)" />
        </div>

        <!-- Name Field -->
        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input id="name" type="text" th:field="*{name}" class="form-control" placeholder="Enter name" required />
            <div class="invalid-feedback">Please enter a product name.</div>
        </div>

        <!-- Price Field -->
        <div class="mb-3">
            <label for="price" class="form-label">Price</label>
            <input id="price" type="number" th:field="*{price}" class="form-control" placeholder="Enter price" step="0.01" required />
            <div class="invalid-feedback">Please enter a valid price.</div>
        </div>

        <!-- Category Dropdown -->
        <div class="mb-3">
            <label for="category" class="form-label">Category</label>
            <select id="category" th:field="*{category.id}" class="form-select" required>
                <option value="" disabled selected>Select category</option>
                <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
            </select>
            <div class="invalid-feedback">Please select a category.</div>
        </div>

        <!-- Buttons: Cancel and Create -->
        <div class="d-flex justify-content-end gap-2 mt-3">
            <a th:href="@{/dashboard/products}" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary">Create</button>
        </div>

    </form>

    <script>
        function previewImage(input) {
          const preview = document.getElementById('imagePreview');
          const file = input.files[0];
          const reader = new FileReader();

          reader.onloadend = function() {
            preview.src = reader.result;
            preview.classList.remove('d-none');
          }

          if (file) {
            reader.readAsDataURL(file);
          } else {
            preview.src = "";
            preview.classList.add('d-none');
          }
        }

        // Bootstrap validation example
        (function () {
          'use strict'
          const forms = document.querySelectorAll('.needs-validation')
          Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
              if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
              }
              form.classList.add('was-validated')
            }, false)
          })
        })()
    </script>
</section>
</body>
</html>
